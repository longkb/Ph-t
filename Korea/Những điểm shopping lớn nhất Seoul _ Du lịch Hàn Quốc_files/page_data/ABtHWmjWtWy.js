if (self.CavalryLogger) { CavalryLogger.start_js(["olVA4"]); }

__d("AudioEvents",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CREATE_STREAM:"AUDIO_CREATE_STREAM",FINISH:"AUDIO_FINISH",LOAD:"AUDIO_LOAD",MUTE:"AUDIO_MUTE",PAUSE:"AUDIO_PAUSE",PLAY:"AUDIO_PLAY",REPLAY:"AUDIO_REPLAY",SCRUB_BEGIN:"AUDIO_SCRUB_BEGIN",SCRUB_END:"AUDIO_SCRUB_END",SEEK:"AUDIO_SEEK",STREAM_CHANGE:"AUDIO_STREAM_CHANGE",UNMUTE:"AUDIO_UNMUTE",UPDATE_BUFFER:"AUDIO_UPDATE_BUFFER",UPDATE_DURATION:"AUDIO_UPDATE_DURATION",UPDATE_TIME:"AUDIO_UPDATE_TIME",VOLUME_CHANGE:"AUDIO_VOLUME_CHANGE",REPLACE_STREAM:"AUDIO_REPLACE_STREAM",FETCH_URL:"AUDIO_FETCH_URL",BLOCK_FETCH:"AUDIO_BLOCK_FETCH",ALLOW_FETCH:"AUDIO_ALLOW_FETCH",SOUNDCLOUD_CHECKPOINT:"AUDIO_SOUNDCLOUD_CHECKPOINT"};}),null);
__d("ChatReliabilityEvents",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ERROR:"error",CHANNEL_DISCONNECT:"channel_disconnect",CHANNEL_CONNECT:"channel_connect",CHANNEL_INIT:"channel_init",CHANNEL_NOCONFIG:"channel_noconfig",CHANNEL_HISTORY_INVALID:"channel_history_invalid",CHANNEL_STALLED:"channel_stalled",MESSAGE_RECEIVED:"msg_received"};}),null);
__d("MessagingRealtimeConstants",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={VIEWER_FBID:"realtime_viewer_fbid"};}),null);
__d("MusicStoryLoggerEvents",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CTA_CLICK:"music_cta_click",ERROR:"music_error",OPEN:"music_open",PAUSE:"music_pause",PLAY:"music_play",PLAY_REQUESTED:"music_play_requested",REACHED_END:"music_reached_end",STALL:"music_stall",SOUNDCLOUD_CHECKPOINT:"music_soundcloud_checkpoint"};}),null);
__d("XSpotifyWebAPIControllerConstants",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={API_URL:"https:\/\/api.spotify.com",AUTH_URL:"https:\/\/accounts.spotify.com",AUTH_PATH:"\/authorize",CLIENT_ID_QUERY_PARAM:"client_id",RESPONSE_TYPE_QUERY_PARAM:"response_type",REDIRECT_URI_QUERY_PARAM:"redirect_uri",SCOPE_QUERY_PARAM:"scope",SHOW_DIALOG_QUERY_PARAM:"show_dialog",STATE_QUERY_PARAM:"state",GRAPHQL_REDIRECT_URI:"https:\/\/m.facebook.com\/spotify_callback",SCOPES:"user-library-modify user-library-read",AUTH_SUCCESS:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_AUTH_SUCCESS",LOGIN_REQUIRED:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_LOGIN_REQUIRED",SAVE_SUCCESS:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_SAVE_SUCCESS",SAVE_FAILED:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_SAVE_FAILED",UNSAVE_SUCCESS:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_UNSAVE_SUCCESS",UNSAVE_FAILED:"SPOTIFY_WEB_API_CONTROLLER_CONSTANTS_UNSAVE_FAILED",UTM_SOURCE_QUERY_PARAM:"utm_source",UTM_MEDIUM_QUERY_PARAM:"utm_medium",UTM_CAMPAIGN_QUERY_PARAM:"utm_campaign",UTM_CONTENT_QUERY_PARAM:"utm_content",UTM_TERM_QUERY_PARAM:"utm_term"};}),null);
__d('Audio',['AudioEvents','EventEmitter','Map','Run','nullthrows'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('EventEmitter'));i=h&&h.prototype;function j(){'use strict';i.constructor.call(this);this.resetAudioStreams();c('Run').onLeave(this.$Audio3.bind(this));}j.prototype.addStream=function(k,l){'use strict';if(!this.$Audio1.has(k)){this.$Audio1.set(k,[]);this.$Audio2.set(k,[]);}var m=c('nullthrows')(this.$Audio1.get(k)).length,n=this.$Audio4(k,m,l.preload);c('nullthrows')(this.$Audio1.get(k)).push(n);c('nullthrows')(this.$Audio2.get(k)).push(false);return m;};j.prototype.play=function(k,l){'use strict';if(!this.$Audio1.has(k)||c('nullthrows')(this.$Audio2.get(k))[l])return;c('nullthrows')(this.$Audio1.get(k))[l].play();c('nullthrows')(this.$Audio2.get(k))[l]=true;};j.prototype.pause=function(k,l){'use strict';if(!this.$Audio1.has(k)||!c('nullthrows')(this.$Audio2.get(k))[l])return;c('nullthrows')(this.$Audio1.get(k))[l].pause();c('nullthrows')(this.$Audio2.get(k))[l]=false;};j.prototype.seek=function(k,l,m){'use strict';c('nullthrows')(this.$Audio1.get(k))[l].currentTime=m;};j.prototype.setVolume=function(k,l,m){'use strict';c('nullthrows')(this.$Audio1.get(k))[l].volume=m;};j.prototype.mute=function(k,l){'use strict';c('nullthrows')(this.$Audio1.get(k))[l].muted=true;};j.prototype.unmute=function(k,l){'use strict';c('nullthrows')(this.$Audio1.get(k))[l].muted=false;};j.prototype.getBufferedPosition=function(k,l){'use strict';var m=c('nullthrows')(this.$Audio1.get(k))[l].buffered,n=m.length;return n?m.end(n-1):0;};j.prototype.getDuration=function(k,l){'use strict';return c('nullthrows')(this.$Audio1.get(k))[l].duration;};j.prototype.getAudioStream=function(k){'use strict';return this.$Audio1.get(k);};j.prototype.getIsPlaying=function(k){'use strict';return this.$Audio2.get(k);};j.prototype.resetAudioStreams=function(){'use strict';this.$Audio1=new (c('Map'))();this.$Audio2=new (c('Map'))();};j.prototype.$Audio3=function(){'use strict';c('Run').onAfterLoad(function(){c('Run').onLeave(this.$Audio3.bind(this));}.bind(this));for(var k=this.$Audio2,l=Array.isArray(k),m=0,k=l?k:k[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var n;if(l){if(m>=k.length)break;n=k[m++];}else{m=k.next();if(m.done)break;n=m.value;}var o=n,p=o[0],q=o[1];for(var r=0,s;r<q.length;r++){s=q[r];if(s){var t=c('nullthrows')(this.$Audio1.get(p))[r];t.pause();t.remove();}}}this.resetAudioStreams();};j.prototype.$Audio4=function(k,l,m){'use strict';var n=document.createElement('audio');n.setAttribute('preload',m?'auto':'metadata');n.addEventListener('loadedmetadata',function(o){this.$Audio5(c('AudioEvents').UPDATE_DURATION,k,l,n.duration);}.bind(this));n.addEventListener('progress',function(o){var p=n.buffered.length;this.$Audio5(c('AudioEvents').UPDATE_BUFFER,k,l,p?n.buffered.end(p-1):0);}.bind(this));n.addEventListener('timeupdate',function(o){this.$Audio5(c('AudioEvents').UPDATE_TIME,k,l,n.currentTime);}.bind(this));n.addEventListener('ended',function(o){this.$Audio5(c('AudioEvents').FINISH,k,l);}.bind(this));n.src=k;return n;};j.prototype.$Audio5=function(k,l,m,n){'use strict';var o={uri:l,index:m,value:n};this.emit(k,o);};f.exports=new j();}),null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel'),i=c('JSLogger').create('channel'),j='channel_sub:',k=7,l=100*1000,m=null,n;function o(){var q=c('WebStorage').getLocalStorage();if(n){clearTimeout(n);n=null;}if(q&&m!=null)q.removeItem(j+m);m=null;}function p(q,r,s){var t,u=(q-1)*k;if(s){if(n)clearTimeout(n);m=n=null;}if(r==null)r=Math.floor(Math.random()*u);if(m==null){var v,w,x,y,z,aa,ba;(function(){var ca=c('WebStorage').getLocalStorage();if(ca){v=[];for(w=0;w<ca.length;w++){x=ca.key(w);if(x.indexOf(j)===0){y=parseInt(x.substr(j.length),10);v[y]=parseInt(ca.getItem(x),10);}}z=Date.now()-l;for(w=0;w<u;w++){aa=(w+r)%u;if(!v[aa]||v[aa]<z){m=aa;break;}}if(m!=null){ba=function da(){try{ca.setItem(j+m,Date.now());}catch(ea){h.warn('subdomain set failed',ea.message);}n=c('setTimeoutAcrossTransitions')(ba,l/2);};ba();}else{h.warn('no channel subdomain',v);i.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',o);}else c('Run').onUnload(o);}else m=r;})();}return m==null?null:m%k;}f.exports={allocate:p,clear:o};}),null);
__d('DocRPC',['ErrorUtils'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_apis:{},_dispatch:function i(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(h._apis.hasOwnProperty(j.api)){var m=h._apis[j.api];if(m[j.method])k=c('ErrorUtils').applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function i(j,k){h._apis[k]=j;},proxy:function i(j,k,l){var i={};l.forEach(function(m){i[m]=function(){var n={api:k,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(j.closed)throw new Error('DocRPC window closed');o=j.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+k+'.'+m+' unparsable return: "'+o+'"');}return o;};});return i;}};f.exports=b.DocRPC=h;}),null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions','BanzaiODS'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(u){return !isNaN(u)&&isFinite(u)&&0<=u&&u<=6;}function k(u,v){var w='';if(j(u.subdomain))w=u.subdomain+'-';var x=u.host;x=x===null||x===undefined?'edge-chat':u.host;var y=new (c('URI'))(v).setDomain(w+x+'.'+u.domain).setPort(u.port).setSecure(new (c('URI'))(window.location.href).isSecure());return y;}function l(u){var v={partition:u.partition,cb:i(),failure:u.pingFailuresOnSubdomain};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;var w=k(u,'/p').setQueryData(v);h.log('start_p',{uri:w.toString()});var x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;var y=function z(aa){h.log('finish_p',{xhr:aa.toJSON?aa.toJSON():aa,subdomain:u.subdomain,fullHost:u.fullHost});};x.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.error');y(z);if(u.subdomain===null)return;if(j(u.subdomain)){u.pingFailuresOnSubdomain++;u.subdomain++;if(u.subdomain>6)u.subdomain=0;}};x.timeout=u.P_TIMEOUT;x.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.success');y(z);};x.send();}function m(u,v,w){var x=new Image(),y=0,z=function ca(da){x.abort();return da?v():w();};x.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-y});c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.success');z(true);},'ChannelTransport image.onload');x.onerror=c('TimeSlice').guard(function(){l(u);c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.error');z(false);},'ChannelTransport image.onerror');var aa=c('setTimeoutAcrossTransitions')(x.onerror,10000);x.abort=function(){if(aa){clearTimeout(aa);aa=null;}x.onload=x.onerror=null;};var ba={partition:u.partition,cb:i()};if(u.sticky_token)ba.sticky_token=u.sticky_token;if(u.sticky_pool)ba.sticky_pool=u.sticky_pool;if(u.lastRequestErrorReason){ba.reason=u.lastRequestErrorReason;u.lastRequestErrorReason=null;}if(u.uid&&u.viewerUid){ba.uid=u.uid;ba.viewer_uid=u.viewerUid;}y=Date.now();x.src=k(u,'/ping').setQueryData(ba);return x;}function n(u,v){var w={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)w.sticky_token=u.sticky_token;if(u.sticky_pool)w.sticky_pool=u.sticky_pool;if(u.profile)w.profile=u.profile;if(u.capabilities)w.cap=u.capabilities;w.id=v;var x=k(u,'/add_bud').setQueryData(w),y=new (c('AjaxRequest'))('GET',x);if(c('AjaxRequest').supportsCORS())y.xhr.withCredentials=true;y.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.error');h.warn('add_buddy_error');};y.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.success');h.log('add_buddy_ok');};y.timeout=u.P_TIMEOUT;y.send();}function o(u){var v={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;if(u.is_offline||u.shouldSuppressPresence){v.state='offline';}else v.state='active';if(v.state===u.lastPresenceState)return;u.lastPresenceState=v.state;if(u.profile)v.profile=u.profile;if(u.capabilities)v.cap=u.capabilities;var w=k(u,'/active_ping').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.error');h.warn('active_ping_error');};x.onSuccess=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.success');h.log('active_ping_ok');};x.timeout=u.P_TIMEOUT;x.send();}function p(u,v,w,x){var y=new Date(),z=-1;if(u.userActive>0){z=(y-u.userActive)/1000|0;if(z<0)h.warn('idle_regression',{idleTime:z,now:y.getTime(),userActive:u.userActive});}var aa={channel:u.user_channel,seq:u.seq,partition:u.partition,clientid:u.sessionID,cb:i(),idle:z,qp:'y',cap:0};if(u.state.aiq)aa.aiq=u.state.aiq;if(u.ready)if(u.seqTurSentAt==-1||u.seqTurSentAt==u.seq){aa.tur=u.timeUntilReady;aa.qpmade=u.queueMade;u.seqTurSentAt=u.seq;}aa.pws=u.pws;if(u.sequenceId>0)aa.isq=u.sequenceId;aa.msgs_recv=u.estimatedReceived;if(u.uid&&u.viewerUid){aa.uid=u.uid;aa.viewer_uid=u.viewerUid;}if(u.sticky_token){aa.sticky_token=u.sticky_token;}else{aa.request_batch=1;if(u.msgr_region)aa.msgr_region=u.msgr_region;}if(u.sticky_pool)aa.sticky_pool=u.sticky_pool;if('trace_id' in u)aa.traceid=u.trace_id;if(u.is_offline||u.shouldSuppressPresence){aa.state='offline';}else if(u.userActive>0&&z<60)aa.state='active';u.lastPresenceState=aa.state;if(u.streamingCapable){aa.mode='stream';aa.format='json';}if(u.profile)aa.profile=u.profile;if(u.capabilities)aa.cap=u.capabilities;var ba=k(u,'/pull').setQueryData(aa),ca='GET',da=new (c('AjaxRequest'))(ca,ba);if(c('AjaxRequest').supportsCORS())da.xhr.withCredentials=true;da.timeout=u.streamingCapable?u.STREAMING_TIMEOUT:u.LONGPOLL_TIMEOUT;da.onJSON=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.json');v(ea);};da.onSuccess=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');w(ea);};da.onError=function(){var ea=this.status==12002&&this._time>=u.MIN_12002_TIMEOUT||this.status==504&&this._time>=u.MIN_504_TIMEOUT,fa=ea?w:x;if(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');}else c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.error');return fa&&fa.apply(this,arguments);};da.send();u.inStreaming=u.streamingCapable;return da;}function q(u){this.manager=u;this.init&&this.init();}function r(u){q.apply(this,arguments);}Object.assign(r.prototype,{logName:'CORS',enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),0);if(!/pull|ping/.test(v))return;var x=this.manager;if(v=='ping'){this._request=m(w,c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(x,'_processTransportData',w.stateId),c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});function s(u){h.log('iframe_init_constructor');q.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(s.prototype,{logName:'iframe',_initIframe:function u(v){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return v.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(v){this._iframeURI=k(v,v.path);if(v.resources){var w=this._iframeURI.getDomain();v.resources=v.resources.map(function(y){var z=new (c('URI'))(y);if(z.getPath().startsWith('/intern/rsrc.php')&&z.getQueryData().origin!==undefined)return z.addQueryData('origin',w).toString();return y;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(x){h.error('iframe_uri_set_error',x);this.exitState({status:c('ChannelConstants').ERROR,stateId:v.stateId},x+'');}},enterState:function u(v,w){if(v=='init'){this._initIframe(w);}else if(/idle|ping|pull/.test(v)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(v!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:w.stateId},'iframe not yet loaded');}else if(v=='shutdown')this._initIframe();},_processTransportData:function u(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function u(v){if(this.manager.state=='init'&&v.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function t(){this.init=this.init.bind(this);q.apply(this,arguments);}Object.assign(t.prototype,{logName:'iframe(inner)',init:function u(){c('DocRPC').publish(this,'innerTransport');try{var w=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,w);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(v){h.error('iframe_inner_init_error',v);}},enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='ping'){this._request=m(w,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(this,'_processTransportData',w.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});f.exports={isSubdomain:j,getURI:k,Transport:q,CORSTransport:r,IframeTransport:s,IframeInnerTransport:t,sendActivePing:o,sendAdditionalBuddyRequest:n};}),null);
__d('ChannelTransportDataLogger',['Arbiter','JSLogger','MercuryLoggingHelper'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=[],i=10,j=function l(m){return m.map(function(n){var o=n;if(n.message||n.delta&&n.delta.body){o=babelHelpers['extends']({},n);if(n.message)o.message=c('MercuryLoggingHelper').obfuscateMessage(n.message);if(n.delta&&n.delta.body)o.delta=c('MercuryLoggingHelper').obfuscateMessage(n.delta);}return o;});},k={log:function l(m){var n={t:m.t,seq:m.seq};if(m.ms)n.ms=j(m.ms);h.push(n);if(h.length>i)h.shift();}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(l,m){m.channelTransportLog=h;});f.exports=k;}),null);
__d('ChatProxyConnectionState',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.auxiliaryIrisQueues={};this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){this.auxiliaryIrisQueues[i]=j;this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){delete this.auxiliaryIrisQueues[i];this.updateCaches();};h.prototype.updateCaches=function(){var i=[];for(var j in this.auxiliaryIrisQueues)if(this.auxiliaryIrisQueues.hasOwnProperty(j)){i.push(j);i.push(this.auxiliaryIrisQueues[j]);}if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;}),null);
__d('ChatReliabilityTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:ChatReliabilityLoggerConfig',this.$ChatReliabilityTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:ChatReliabilityLoggerConfig',this.$ChatReliabilityTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$ChatReliabilityTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$ChatReliabilityTypedLogger1=babelHelpers['extends']({},this.$ChatReliabilityTypedLogger1,j);return this;};h.prototype.setEvent=function(j){this.$ChatReliabilityTypedLogger1.event=j;return this;};h.prototype.setEventData=function(j){this.$ChatReliabilityTypedLogger1.event_data=j;return this;};var i={event:true,event_data:true};f.exports=h;}),null);
__d('ChatReliabilityInstrumentation',['ChatReliabilityEvents','ChatReliabilityTypedLogger','MercuryConfig'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=function j(event,k){if(!c('MercuryConfig').EnableReliabilityLogging)return;new (c('ChatReliabilityTypedLogger'))().setEvent(event).setEventData(k).log();},i={logERROR:function j(k){h(c('ChatReliabilityEvents').ERROR,k);},logCHANNEL_DISCONNECT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_DISCONNECT,k);},logCHANNEL_CONNECT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_CONNECT,k);},logCHANNEL_HISTORY_INVALID:function j(k){h(c('ChatReliabilityEvents').CHANNEL_HISTORY_INVALID,k);},logMESSAGE_RECEIVED:function j(k){h(c('ChatReliabilityEvents').MESSAGE_RECEIVED,k);},logCHANNEL_STALLED:function j(k){h(c('ChatReliabilityEvents').CHANNEL_STALLED,k);},logCHANNEL_INIT:function j(k){h(c('ChatReliabilityEvents').CHANNEL_INIT,k);},logCHANNEL_NOCONFIG:function j(k){h(c('ChatReliabilityEvents').CHANNEL_NOCONFIG,k);}};f.exports=i;}),null);
__d('PresenceUtil',['CurrentUser','randomInt'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('randomInt')(0,4294967295)+1;function i(){return h;}function j(){return c('CurrentUser').isLoggedInNow();}f.exports={getSessionID:i,hasUserCookie:j};}),null);
__d('PresencePrivacy',['Arbiter','AsyncRequest','ChannelConstants','CurrentUser','PresencePrivacyInitialData','JSLogger','PresenceUtil'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='/ajax/chat/privacy/settings.php',i='/ajax/chat/privacy/online_policy.php',j='/ajax/chat/privacy/visibility.php',k='friend_visibility',l='visibility',m='online_policy',n=babelHelpers['extends']({},c('PresencePrivacyInitialData').privacyData),o=c('PresencePrivacyInitialData').visibility,p=babelHelpers['extends']({},c('PresencePrivacyInitialData').privacyData),q=o,r=c('PresencePrivacyInitialData').onlinePolicy,s=r,t=[],u=false;function v(){return c('JSLogger').create('blackbird');}var w=Object.assign(new (c('Arbiter'))(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function x(ja){var ka;for(ka in ja){var la=ja[ka];if(ka==c('CurrentUser').getID()){v().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(la){case w.WHITELISTED:case w.BLACKLISTED:case w.UNLISTED:break;default:v().error('set_invalid_friend_visibility',{id:ka,value:la});throw new Error("Invalid state: "+la);}}for(ka in ja)n[ka]=ja[ka];w.inform('privacy-changed');}function y(ja,ka){var la={};la[ja]=ka;x(la);}function z(ja){switch(ja){case w.ONLINE:case w.OFFLINE:break;default:v().error('set_invalid_visibility',{value:ja});throw new Error("Invalid visibility: "+ja);}o=ja;w.inform('privacy-changed');w.inform('privacy-user-presence-changed');}function aa(ja){switch(ja){case w.ONLINE_TO_WHITELIST:case w.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+ja);}r=ja;w.inform('privacy-user-presence-changed');w.inform('privacy-changed');}function ba(ja,ka){u=true;ja.send();}function ca(ja,ka){t.push({request:ja,data:ka});if(!u){var la=t.shift();ba(la.request,la.data);}}function da(ja,ka){var la=ja.type;if(la===k){w.inform('privacy-availability-changed');for(var ma in ja.settings)p[ma]=ja.settings[ma];}else{if(la===l){q=ja.visibility;}else if(la===m)s=ja.online_policy;w.inform('privacy-user-presence-response');}v().log('set_update_response',{data:ja,response:ka});}function ea(ja,ka){if(o!==q)z(q);if(r!==s)aa(s);Object.assign(n,p);w.inform('privacy-changed');t=[];v().log('set_error_response',{data:ja,response:ka});}function fa(ja){u=false;if(t.length>0){var ka=t.shift();ba(ka.request,ka.data);}}function ga(ja,ka){if(c('PresenceUtil')!=null){var la=ja.getData();la.window_id=c('PresenceUtil').getSessionID();ja.setData(la);}ja.setHandler(da.bind(this,ka)).setErrorHandler(ea.bind(this,ka)).setTransportErrorHandler(ea.bind(this,ka)).setFinallyHandler(fa.bind(this)).setAllowCrossPageTransition(true);return ja;}function ha(ja,ka,la){return ga(new (c('AsyncRequest'))(ja).setData(ka),la);}function ia(ja,ka){var la=ka.obj;if(la.viewer_id!=c('CurrentUser').getID()){v().error('invalid_viewer_for_channel_message',{type:ja,data:ka});throw new Error("Viewer got from the channel is not the real viewer");}if(la.window_id===c('PresenceUtil').getSessionID())return;var ma=la.data;if(la.event=='access_control_entry'){ma.target_ids.forEach(function(oa){y(oa,ma.setting);p[oa]=ma.setting;});}else{if(la.event=='visibility_update'){var na=!!ma.visibility?w.ONLINE:w.OFFLINE;z(na);q=na;}else if(la.event=='online_policy_update'){aa(ma.online_policy);s=ma.online_policy;}w.inform('privacy-user-presence-response');}v().log('channel_message_received',{data:ka.obj});}Object.assign(w,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function ja(ka,la,ma){},setVisibility:function ja(ka){q=o;z(ka);var la={visibility:ka},ma={type:l,visibility:ka},na=ha(j,la,ma);ca(na,ma);v().log('set_visibility',{data:la});return ka;},getVisibility:function ja(){return o;},setOnlinePolicy:function ja(ka){s=r;aa(ka);var la={online_policy:ka},ma={type:m,online_policy:ka},na=ha(i,la,ma);ca(na,ma);v().log('set_online_policy',{data:la});return ka;},getOnlinePolicy:function ja(){return r;},getFriendVisibility:function ja(ka){return n[ka]||w.UNLISTED;},isUserOffline:function ja(){return this.getVisibility()===w.OFFLINE;},allows:function ja(ka){if(this.isUserOffline())return false;var la=this.getOnlinePolicy();return la===w.ONLINE_TO_WHITELIST?n[ka]==w.WHITELISTED:n[ka]!=w.BLACKLISTED;},setFriendsVisibility:function ja(ka,la){if(ka.length>0){var ma={};for(var na=0;na<ka.length;na++){var oa=ka[na];p[oa]=n[oa];ma[oa]=la;}x(ma);var pa=la;if(pa==w.UNLISTED)pa=p[ka[0]];var qa={users:ka,setting:la,setting_type:pa},ra={type:k,settings:ma},sa=ha(h,qa,ra);ca(sa,ra);v().log('set_friend_visibility',{data:qa});}return la;},setFriendVisibilityMap:function ja(ka,la){for(var ma in ka)p[ma]=n[ma];x(ka);var na={type:k,settings:ka};ca(ga(la,na),na);v().log('set_friend_visibility_from_map',{data:ka});},allow:function ja(ka){if(this.allows(ka)){v().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===w.OFFLINE){v().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var la=this.getOnlinePolicy()===w.ONLINE_TO_WHITELIST?w.WHITELISTED:w.UNLISTED;return this.setFriendsVisibility([ka],la);},disallow:function ja(ka){if(!this.allows(ka)){v().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===w.OFFLINE){v().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var la=this.getOnlinePolicy()===w.ONLINE_TO_BLACKLIST?w.BLACKLISTED:w.UNLISTED;return this.setFriendsVisibility([ka],la);},getBlacklist:function ja(){var ka=[];for(var la in n)if(n[la]===w.BLACKLISTED)ka.push(la);return ka;},getWhitelist:function ja(){var ka=[];for(var la in n)if(n[la]===w.WHITELISTED)ka.push(la);return ka;},getMapForTest:function ja(){return n;},setMapForTest:function ja(ka){n=ka;}});w.inform('privacy-changed');w.inform('privacy-user-presence-changed',c('Arbiter').BEHAVIOR_STATE);v().log('initialized',{visibility:o,policy:r});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ja,ka){ka.presence_privacy={initial:c('PresencePrivacyInitialData').privacyData,current:n};});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('privacy_changed'),ia.bind(this));c('Arbiter').subscribe(c('ChannelConstants').ON_CONFIG,function(ja,ka){var la=ka.getConfig('visibility',null);if(la!==null&&typeof la!=='undefined'){var ma=la?w.ONLINE:w.OFFLINE;z(ma);v().log('config_visibility',{vis:ma});}}.bind(this));f.exports=w;}),null);
__d('ChatVisibility',['Arbiter','JSLogger','PresencePrivacy'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isOnline:function i(){return c('PresencePrivacy').getVisibility()===c('PresencePrivacy').ONLINE;},hasBlackbirdEnabled:function i(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function i(){return c('PresencePrivacy').getOnlinePolicy()===c('PresencePrivacy').ONLINE_TO_BLACKLIST&&c('PresencePrivacy').getBlacklist().length>0;},isVisibleToSomeFriends:function i(){return c('PresencePrivacy').getOnlinePolicy()===c('PresencePrivacy').ONLINE_TO_WHITELIST&&c('PresencePrivacy').getWhitelist().length>0;},goOnline:function i(j){if(c('PresencePrivacy').getVisibility()===c('PresencePrivacy').OFFLINE){c('JSLogger').create('blackbird').log('chat_go_online');c('PresencePrivacy').setVisibility(c('PresencePrivacy').ONLINE);c('Arbiter').inform('chat-visibility/go-online');}j&&j();},goOffline:function i(j){if(c('PresencePrivacy').getVisibility()===c('PresencePrivacy').ONLINE){c('JSLogger').create('blackbird').log('chat_go_offline');c('PresencePrivacy').setVisibility(c('PresencePrivacy').OFFLINE);c('Arbiter').inform('chat-visibility/go-offline');}j&&j();},toggleVisibility:function i(){if(h.isOnline()){h.goOffline();}else h.goOnline();}};f.exports=h;}),null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;}),null);
__d('FBRTCSupport',['ChannelConstants','RTCConfig','UserAgent'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isSendWebrtcSupported:function i(){return c('RTCConfig').SendNewVCGK;},isReceiveWebrtcSupported:function i(){return c('RTCConfig').ReceiveNewVCGK;},isVideoInteropSupported:function i(){return c('RTCConfig').VideoInteropGK;},isVideoCallBlockingSupported:function i(){return c('RTCConfig').VideoCallBlockingGK;},isWebrtcSupported:function i(){return (c('UserAgent').isBrowser('Chrome >= 28')||c('UserAgent').isBrowser('Firefox >= 25')||c('UserAgent').isBrowser('Opera >= 20'));},isCollabSupported:function i(){return c('RTCConfig').CollabWhitelistedBrowserGK||c('UserAgent').isBrowser('Chrome >= 48');},isOSSupported:function i(){return !c('UserAgent').isPlatform('Android')&&!c('UserAgent').isPlatform('iOS');},getCapabilities:function i(){var j=0;if(this.isReceiveWebrtcSupported())j=c('ChannelConstants').CAPABILITY_VOIP_INTEROP;return j;}};f.exports=h;}),null);
__d('FantailLogger',['FantailConfig'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('FantailConfig').FantailLogQueue,i={debug:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).debug.apply(m,[l].concat(o));},info:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).info.apply(m,[l].concat(o));},warn:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).warn.apply(m,[l].concat(o));},error:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).error.apply(m,[l].concat(o));}};f.exports=i;}),null);
__d("MovingStat",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;}),null);
__d('Dcode',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function l(m){return encodeURIComponent(m).replace(/([_A-Z])|%../g,function(n,o){return o?'%'+o.charCodeAt(0).toString(16):n;}).toLowerCase().replace(h,function(n){return i[n];});},decode:function l(m){return decodeURIComponent(m.replace(/[_A-Z]/g,function(n){return j[n];}));}};f.exports=k;}),null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('PresenceInitialData').cookieVersion,i='presence',j={},k=null,l=null,m=c('JSLogger').create('presence_cookie');function n(){try{var r=c('Cookie').get(i);if(k!==r){k=r;l=null;if(r&&r.charAt(0)=='E')r=c('Dcode').decode(r.substring(1));if(r)l=JSON.parse(r);}if(l){if(l.user&&l.user!==c('CurrentUser').getID())return null;if(l.v!==h)return null;return l;}}catch(q){m.warn('getcookie_error',q);}return null;}function o(){return parseInt(Date.now()/1000,10);}var p={register:function q(r,s){j[r]=s;},store:function q(){var r=n();if(r&&r.v&&h<r.v){m.debug('stale_cookie',h);return;}var s={v:h,time:o(),user:c('CurrentUser').getID()};for(var t in j)s[t]=c('ErrorUtils').applyWithGuard(j[t],j,[r&&r[t]],function(x){x.presence_subcookie=t;});var u='E'+c('Dcode').encode(JSON.stringify(s));if(c('PresenceUtil').hasUserCookie()){var v=u.length;if(v>1024)m.warn('big_cookie',v);var w=c('URI').getRequestURI(false).isSecure()&&!!c('Cookie').get('csm');c('Cookie').set(i,u,null,null,w);}},clear:function q(){c('Cookie').clear(i);},getSubCookie:function q(r){var s=n();if(!s)return null;return s[r];}};f.exports=p;}),null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('PresenceInitialData').cookiePollInterval||2000,i=c('PresenceInitialData').shouldSuppress||false,j=[],k=[],l=null,m=null,n=0,o=null,p=0,q=['sb2','t2','lm2','uct2','tr','tw','at','wml'],r=c('JSLogger').create('presence_state');function s(){return c('PresenceCookieManager').getSubCookie('state');}function t(){n=Date.now();c('PresenceCookieManager').store();x(m);}var u=c('debounceAcrossTransitions')(t,0);function v(ca){if(typeof ca=='undefined'||isNaN(ca)||ca==Number.POSITIVE_INFINITY||ca==Number.NEGATIVE_INFINITY)ca=0;return ca;}function w(ca){var da={};if(ca){q.forEach(function(ga){da[ga]=ca[ga];});if(n<ca.ut)r.error('new_cookie',{cookie_time:ca.ut,local_time:n});}da.ut=n;for(var ea=0,fa=j.length;ea<fa;ea++)c('ErrorUtils').applyWithGuard(j[ea],null,[da]);m=da;return m;}function x(ca){p++;n=v(ca.ut);if(!l)l=c('setIntervalAcrossTransitions')(aa,h);m=ca;if(o===null)o=ca;for(var da=0,ea=k.length;da<ea;da++)c('ErrorUtils').applyWithGuard(k[da],null,[ca]);p--;}function y(ca){if(ca&&ca.ut)if(n<ca.ut){return true;}else if(ca.ut<n)r.error('old_cookie',{cookie_time:ca.ut,local_time:n});return false;}function z(){var ca=s();if(y(ca))m=ca;return m;}function aa(){var ca=s();if(y(ca))x(ca);}c('PresenceCookieManager').register('state',w);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ca,da){da.presence_state={initial:babelHelpers['extends']({},o),state:babelHelpers['extends']({},m),update_time:n,sync_paused:p,poll_time:h};});(function(){var ca=z();if(ca){x(ca);}else{r.debug('no_cookie_initial');x(w());return;}})();var ba={doSync:function ca(da){if(p)return;if(da){t();}else u();},registerStateStorer:function ca(da){j.push(da);},registerStateLoader:function ca(da){k.push(da);},get:function ca(){return z();},getInitial:function ca(){return o;},shouldSuppress:function ca(){return i;},verifyNumber:v};f.exports=ba;}),null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){!k?h(0):void 0;!n?h(0):void 0;!o?h(0):void 0;this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){!k?h(0):void 0;!l?h(0):void 0;!n?h(0):void 0;var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!!l[u]?h(0):void 0;Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;}),null);
__d('ChannelManager',['errorCode','Promise','AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChannelTransportDataLogger','ChatVisibility','ChatReliabilityInstrumentation','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','SystemEvents','URI','UserActivity','ChatProxyConnectionState','emptyFunction','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null,m=c('emptyFunction'),n=new (c('Promise'))(function(aa,ba){m=aa;});function o(aa){l=aa;}var p={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},q={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},r=1,s={},t=0;function u(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function v(){var aa={};if(i.getConfig('host'))aa[i.getConfig('user_channel')]=i.getConfig('seq',0);return aa;}function w(){var aa=Date.now(),ba=Date.now(),ca={total:0},da='idle',ea=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ha,ia){x(true);ba=null;i.lastPullTime=Date.now();var ja;switch(ha){case c('SystemEvents').USER:ja=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ja=ia?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(0<ia&&ia<180000&&q.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %s',ia);return;}ja=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ja,stateId:r});});var fa=function ha(ia,ja){var ka=Date.now(),la=null;if(ja){aa=ka;la=ja.nextState||ja.state;}else la=da;c('SystemEvents').checkTimeTravel();if(ba){var ma=Math.round((ka-ba)/1000);if(ma>0){ca[da]=(ca[da]||0)+ma;ca.total+=ma;}}da=la;ba=ka;if(!ia){ca.lastSuccessTime=u();ca.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(ca));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,fa);c('setIntervalAcrossTransitions')(fa,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ha,ia){ia.channelRollup=ca;});var ga=function ha(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ia=Date.now()-(i.lastPullTime||c('Env').start);if(!ea&&ia>q.STALL_THRESHOLD){var ja=u();k.error('stall',JSON.stringify({lastSuccessTime:ja,rollupState:da}));c('ChatReliabilityInstrumentation').logCHANNEL_STALLED(ia.toString());ea=true;}var ka=Date.now()-aa;if(i.state=='pull'&&ka>q.JUMPSTART_THRESHOLD){aa=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ka}));i.enterState('init');}};c('setIntervalAcrossTransitions')(ga,5000);}function x(aa){if(aa){t=0;s={};}else t++;}function y(aa,ba){var ca=!c('AjaxRequest').supportsCORS()||q.forceIframe;if(!q.hasOwnProperty('host'))c('ChatReliabilityInstrumentation').logERROR('channel: no host in config');var da=c('ChannelTransport').isSubdomain(q.subdomain);if(!da||ca){q.fullHost=q.host;}else q.fullHost=q.subdomain+'-'+q.host;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'received lb info: %s at seq: %s{%s} with '.concat('sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,').concat(' source: %s, args: %s'),q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,q.subdomain,q.fullHost,i.state,aa,ba);}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:o,backoff:false,sessionRegistered:false,init:function aa(ba,ca){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'initializing sessionid:%s at iris-seq:%s',q.sessionID,q.sequenceId);this.init=c('emptyFunction');c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,ga){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %s {%s} with sticky: %s/%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool);c('UserActivity').subscribe(function(){var ga=c('ChannelTransport').getURI(q,'/U');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'user activity sessionid: %s at seq: %s/{%s} '+'with sticky: %s/%s state: %s uri:%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,i.state,ga);if(i.state=='pull'){q.userActive=Date.now();c('ChannelTransport').sendActivePing(q);}});});c('PresenceCookieManager').register('ch',v);var da=this.getConfig('max_conn',2);q.subdomain=c('ChannelSubdomain').allocate(da);if(!c('ChannelTransport').isSubdomain(q.subdomain)){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'invalid subdomain from ChannelSubdomain: %s',q.subdomain);q.subdomain=null;}this._transportRate=new (c('MovingStat'))(30000);var ea=c('AjaxRequest').supportsCORS()&&!q.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[ea])(this);m(this.transport);if(ba)this.enterState(ba,ca);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,ga){if(this._transportRate){ga.transportRate=this._transportRate.tally();ga.transportType=ea;ga.transportVersion=2;}}.bind(this));w();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('fullHost')&&c('AjaxRequest').supportsCORS()&&!q.forceIframe){var fa=q.MIN_INIT_PROBE_DELAY+Math.random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,fa);}},configure:function aa(){for(var ba=arguments.length,ca=Array(ba),da=0;da<ba;da++)ca[da]=arguments[da];k.log('configure',JSON.stringify(ca));ca.forEach(function(ea){return Object.assign(q,ea);});y('reconnect',JSON.stringify(ca));c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function aa(ba,ca){return q.hasOwnProperty(ba)?q[ba]:ca;},getCompleteConfig:function aa(){return q;},subscribeIrisQueue:function aa(ba,ca){q.state.subscribeIrisQueue(ba,ca);this.exitState({status:c('ChannelConstants').OK,stateId:r});},unsubscribeIrisQueue:function aa(ba){q.state.unsubscribeIrisQueue(ba);},informCurrentSession:function aa(){var ba=null;if(this.sessionRegistered&&q&&q.fullHost&&q.sticky_token&&q.uid)ba=new (c('RTISession'))(q.fullHost,q.port,q.sticky_pool,q.sticky_token,q.uid,q.viewerUid,q.profile,q.sessionID,q.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,ba);},isShutdown:function aa(){return this.state=='shutdown';},shouldIdle:function aa(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function aa(ba){var ca=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:ba,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ca.specifiesWriteRequiredParams()&&ca.send();},_getDelay:function aa(){var ba=Math.min(q.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,t-1)),q.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in q)ba=q.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(ba*(1+Math.random()*.5));},resetDelay:function aa(){x(true);},enterState:function aa(){if(this._inEnterState){k.warn('enterstate_recursion',JSON.stringify({state:this.state,args:arguments}));c('ChatReliabilityInstrumentation').logERROR('enterstate_recursion');}this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ba){this._inEnterState=false;throw ba;}},_enterState:function aa(ba){var ca=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',ba);return;}if(ba!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}r++;q.stateId=r;clearTimeout(this._deferredTransition);this._deferredTransition=null;if(!this.transport){n.done(function(ia){return ia.enterState('idle');});c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ba)){if(this._transportRate){var da=this._transportRate.tally().timeAverage,ea=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(da>=ea){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');ca=1000/ea;}}}else if(!(/#$/.test(ba)))ca=this._getDelay();ba=ba.replace(/\W*$/,'');if(!p[ba]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',ba);throw new Error('invalid state:'+ba);}var fa=Array.from(arguments),ga;if(ca<=0){ga={state:ba};if(this._transportRate)this._transportRate.add(1);this.state=ba;var ha=this['_enter_'+this.state];if(ha){fa.shift();ha.apply(this,fa);}if(/init|idle|pull|ping/.test(this.state)){if(q.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];q.is_offline=!c('ChatVisibility').isOnline();q.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);if(!this.transport){n.done(function(ia){return ia.enterState(this.state,q);}.bind(this));c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState(this.state,q);if(this.state=='ping'){ga.url=c('ChannelTransport').getURI(q).toString();ga.port=q.port||'undefined';}}}else{this.state='idle';this.nextState=ba;ga={state:this.state,delay:ca,nextState:ba};fa[0]=ba+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,fa);}.bind(this),ca);}if(/pull/.test(ba)){ga.client_id=q.sessionID;ga.streaming=q.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,ga);},exitState:function aa(ba,ca){var da=ba.stateId,ea=ba.status;if(this.isShutdown()||da<r)return;var fa=this.state,ga=Array.from(arguments);ga[0]=ba.status;var ha={state:fa,status:ea};if(/pull/.test(fa)){ha.client_id=q.sessionID;ha.streaming=q.inStreaming;}if(/ping/.test(fa)&&ea!=c('ChannelConstants').OK)ha.url=c('ChannelTransport').getURI(q).toString();if(this.nextState)ha.nextState=this.nextState;if(ca&&ca.errorType){q.lastRequestErrorReason=ca.errorType;ha.xhr=ca.toJSON?ca.toJSON():ca;if(ca.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete ha.xhr.json;}else if(ea!=c('ChannelConstants').OK)q.lastRequestErrorReason=ea;if(ca&&ca.json){if(ca.json.t)ha.t=ca.json.t;if(ca.json.reason)ha.reason=ca.json.reason;if(ca.json.seq)ha.seq=ca.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,ha);var ia=this['_exit_'+fa];if(ia)ea=ia.apply(this,ga)||ea;if(ea!=c('ChannelConstants').OK){x();s[fa]=(s[fa]||0)+1;}var ja=p[this.nextState||fa][ea]||p._all[ea],ka=ja&&ja.replace(/!*$/,'');if(!ka){k.error('terminal_transition',JSON.stringify(ha));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ja='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=fa;this._lastStatus=ea;this.enterState(ja);},_processTransportData:function aa(ba,ca){this._processTransportData0(ba,ca,ca.json);},_processTransportData0:function aa(ba,ca,da){var ea=da.t;if('s' in da){da.seq=da.s;delete da.s;}if(da.u&&q.user&&da.u!=q.user){k.warn('misguided_msg',JSON.stringify({user:q.user,target:da.u}));this._reportProxyMisguidedMsg(da.u,q.user);return;}c('ChannelTransportDataLogger').log(da);var fa=q.seq;if('seq' in da){q.seq=da.seq;c('PresenceState').doSync();}switch(ea){case 'continue':if(q.inStreaming&&this.heartbeats.length<1){q.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,q.PROBE_DELAY);}x(true);if(!q.inStreaming||q.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:ba});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',da.reason);this.exitState({status:'refresh_'+(da.reason||0),stateId:ba},ca);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');x();this.backoff=true;break;case 'lb':var ga=da.lb_info;if(ga){q.sticky_token=ga.sticky;if('pool' in ga)q.sticky_pool=ga.pool;if('sd' in ga){var ha=ga.subdomain;if(c('ChannelTransport').isSubdomain(ha))q.subdomain=ga.subdomain;}if('vip' in ga)q.host=ga.vip;y('chatproxy',JSON.stringify(da));}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);x(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var ia=c('ChannelConstants').OK;this.exitState({status:ia,stateId:ba},ca);if('ms' in da)this._processMessages(da,fa);break;case 'msg':x(true);this._processMessages(da,fa);break;case 'heartbeat':if(q.inStreaming){var ja=Date.now();if(this.heartbeats.length>0)var ka=ja-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:q.sessionID,interval:ka}));this.heartbeats.push(ja);}break;case 'batched':var la=da.batches,ma;for(ma=0;ma<la.length;ma++)this._processTransportData0(ba,ca,la[ma]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',ea);k.error('unknown_msg_type',JSON.stringify({type:ea}));break;}},_processMessages:function aa(ba,ca){var da,ea,fa,ga;if('tr' in ba)q.trace_id=ba.tr;ea=ba.ms;fa=q.seq-ea.length;for(da=0;da<ea.length;da++,fa++){q.estimatedReceived++;if(fa>=ca){ga=ea[da];if(ga.type){var ha=c('ChannelConstants').getArbiterType(ga.type);if(ga.type==='messaging'){var ia={type:'messaging',event:ga.event};if(ga.message){ia.inbox_unread=ga.unread_counts&&ga.unread_counts.inbox;ia.tid=ga.message.tid;ia.mid=ga.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',ga.message.mid);}}else if(ga.type==='pages_messaging'){if(ga.unread_counts&&ga.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:ga[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:ga.unread_counts.inbox});}else if(ga.type==='skywalker'){ha=c('ChannelConstants').SKYWALKER;}else if(ga.type==='qprimer'){ga.first=!q.ready;if(ga.first){q.ready=true;q.timeUntilReady=Date.now()-q.created;q.queueMade=ga.made;}ha=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(ga.type==='pws'){q.pws=ga.pws;}else if(ga.type==='delta')q.sequenceId=ga.iseq;c('Arbiter').inform(ha,{obj:ga});}}else k.warn('seq_regression',JSON.stringify({last_seq:ca,messages:ea.length,seq:fa}));}},_enter_init:function aa(){if(s.init>=i.getConfig('MAX_INIT_FAILS',2))return c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR_MAX,stateId:r});}.bind(this),0);this._initTimer=c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR,stateId:r},'timeout');}.bind(this),q.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function aa(ba){k.warn('enter_reconnect',ba);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',ba);var ca=r;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');c('setTimeoutAcrossTransitions')(function(){this._shutdownHint=c('ChannelConstants').HINT_AUTH;this.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:ca});}.bind(this),0);return;}var da={reason:ba,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)da.fb_isb=c('ISB').token;if(l)l(da);var ea=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',da);ea.onSuccess=function(){i.configure(ea.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:ca});}.bind(this);ea.onError=function(){var fa=ea.json&&ea.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',ea.errorType);if(ea.errorType==c('AjaxRequest').TRANSPORT_ERROR||ea.errorType==c('AjaxRequest').PROXY_ERROR||ea.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(fa&&fa==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(fa==1357001||fa==1357004||fa==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:ca},ea);}.bind(this);ea.send();},_enter_shutdown:function aa(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in q&&q.shutdown_recovery_interval_seconds>0){var ba=q.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this._shutdownHint=null;this.state='reconnect!';this.enterState('reconnect!');}.bind(this),ba);}},_exit_init:function aa(ba){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ba==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function aa(ba,ca){var da=ba==c('ChannelConstants').OK;if(da){this.lastPullTime=Date.now();}else{var ea='exit status: '+ba;if(ca&&ca.errorType)ea+=' ajax request error: '+ca.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',ea);}},_exit_ping:function aa(ba){if(ba==c('ChannelConstants').OK){var ca=Date.now()-(this.lastPullTime||c('Env').start);if(ca>q.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',ba);},_reportProxyMisguidedMsg:function aa(ba,ca){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %s meant for %s',ca,ba);var da=Date.now();if(da-this.lastReportOnMisguidedMsgTime<=q.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=da;var ea={received_uid:ba,expected_uid:ca};if(q.sticky_token)ea.sticky_token=q.sticky_token;var fa=new (c('URI'))('/err_misguided_msg').setDomain(q.host+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ea),ga=new (c('AjaxRequest'))('GET',fa);if(c('AjaxRequest').supportsCORS())ga.xhr.withCredentials=true;ga.onSuccess=function(ha){};ga.onError=function(ha){};ga.onJSON=function(ha,ia){};ga.send();},_probeTest:function aa(){q.streamingCapable=false;var ba=[],ca={mode:'stream',format:'json'};if(q.sticky_token)ca.sticky_token=q.sticky_token;var da=new (c('URI'))('/probe').setDomain(q.fullHost+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ca),ea=new (c('AjaxRequest'))('GET',da);ea.onJSON=function(fa,ga){if(fa&&fa.json&&fa.json.t==='heartbeat'){ba.push(Date.now());if(ba.length>=2){var ha=ba[1]-ba[0];if(ha>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&ha<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){q.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};ea.onSuccess=function(fa){if(ba.length!=2){q.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+ba.length}));}k.log('probe_success','{}');};ea.onError=function(fa){q.streamingCapable=false;k.error('probe_error',JSON.stringify(fa));};ea.send();}};f.exports=i;function z(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);c('ChatReliabilityInstrumentation').logCHANNEL_INIT();}else c('ChatReliabilityInstrumentation').logCHANNEL_NOCONFIG();}z();}),6);
__d('MusicStoryTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('music_story_logger:MusicStoryLoggerConfig',this.$MusicStoryTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('music_story_logger:MusicStoryLoggerConfig',this.$MusicStoryTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MusicStoryTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MusicStoryTypedLogger1=babelHelpers['extends']({},this.$MusicStoryTypedLogger1,j);return this;};h.prototype.setAlbumTitle=function(j){this.$MusicStoryTypedLogger1.album_title=j;return this;};h.prototype.setArtistName=function(j){this.$MusicStoryTypedLogger1.artist_name=j;return this;};h.prototype.setAudioDurationMs=function(j){this.$MusicStoryTypedLogger1.audio_duration_ms=j;return this;};h.prototype.setAudioTitle=function(j){this.$MusicStoryTypedLogger1.audio_title=j;return this;};h.prototype.setClientUserID=function(j){this.$MusicStoryTypedLogger1.client_userid=j;return this;};h.prototype.setContainermodule=function(j){this.$MusicStoryTypedLogger1.containermodule=j;return this;};h.prototype.setContentID=function(j){this.$MusicStoryTypedLogger1.content_id=j;return this;};h.prototype.setCtaAction=function(j){this.$MusicStoryTypedLogger1.cta_action=j;return this;};h.prototype.setError=function(j){this.$MusicStoryTypedLogger1.error=j;return this;};h.prototype.setEvent=function(j){this.$MusicStoryTypedLogger1.event=j;return this;};h.prototype.setHasMinutiae=function(j){this.$MusicStoryTypedLogger1.has_minutiae=j;return this;};h.prototype.setMinutiaeID=function(j){this.$MusicStoryTypedLogger1.minutiae_id=j;return this;};h.prototype.setMusicID=function(j){this.$MusicStoryTypedLogger1.music_id=j;return this;};h.prototype.setPlatformName=function(j){this.$MusicStoryTypedLogger1.platform_name=j;return this;};h.prototype.setPlayDurationMs=function(j){this.$MusicStoryTypedLogger1.play_duration_ms=j;return this;};h.prototype.setPlaylistName=function(j){this.$MusicStoryTypedLogger1.playlist_name=j;return this;};h.prototype.setStallDurationMs=function(j){this.$MusicStoryTypedLogger1.stall_duration_ms=j;return this;};h.prototype.setStartDelayMs=function(j){this.$MusicStoryTypedLogger1.start_delay_ms=j;return this;};h.prototype.setStoryType=function(j){this.$MusicStoryTypedLogger1.story_type=j;return this;};h.prototype.setUnplayedBufferTimeMs=function(j){this.$MusicStoryTypedLogger1.unplayed_buffer_time_ms=j;return this;};var i={album_title:true,artist_name:true,audio_duration_ms:true,audio_title:true,client_userid:true,containermodule:true,content_id:true,cta_action:true,error:true,event:true,has_minutiae:true,minutiae_id:true,music_id:true,platform_name:true,play_duration_ms:true,playlist_name:true,stall_duration_ms:true,start_delay_ms:true,story_type:true,unplayed_buffer_time_ms:true};f.exports=h;}),null);
__d('MusicStoryDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this);}f.exports=new j({strict:true});}),null);
__d('MusicStoryAudioActions',['AudioEvents','AudioStream','MusicStoryDispatcher'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={createStream:function i(j,k,l,m,n){var o={type:c('AudioEvents').CREATE_STREAM,titleUriList:j,loggingData:k,uniqueId:l,extraData:m,isDynamicUri:n};c('MusicStoryDispatcher').dispatch(o);},play:function i(j){var k={type:c('AudioEvents').PLAY,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},pause:function i(j){var k={type:c('AudioEvents').PAUSE,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},scrubBegin:function i(j){var k={type:c('AudioEvents').SCRUB_BEGIN,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},scrubEnd:function i(j,k){var l={type:c('AudioEvents').SCRUB_END,uniqueId:j,value:k};c('MusicStoryDispatcher').dispatch(l);},mute:function i(j){var k={type:c('AudioEvents').MUTE,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},unmute:function i(j){var k={type:c('AudioEvents').UNMUTE,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},setVolume:function i(j,k){var l={type:c('AudioEvents').VOLUME_CHANGE,uniqueId:j,value:k};c('MusicStoryDispatcher').dispatch(l);},updatePlaybackPos:function i(j,k){var l={type:c('AudioEvents').UPDATE_TIME,uniqueId:j,value:k};if(!c('MusicStoryDispatcher').isDispatching())c('MusicStoryDispatcher').dispatch(l);},updateDuration:function i(j,k,l,m){var n={type:c('AudioEvents').UPDATE_DURATION,uniqueId:j,value:k,uri:l,copyNumber:m};c('MusicStoryDispatcher').dispatch(n);},updateBufferedPos:function i(j,k){var l={type:c('AudioEvents').UPDATE_BUFFER,uniqueId:j,value:k};if(!c('MusicStoryDispatcher').isDispatching())c('MusicStoryDispatcher').dispatch(l);},updateIsFinished:function i(j){var k={type:c('AudioEvents').FINISH,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},changeStream:function i(j,k,l){var m={type:c('AudioEvents').STREAM_CHANGE,uniqueId:j,value:k,previousTitle:l};c('MusicStoryDispatcher').dispatch(m);},deleteStream:function i(j){var k={type:c('AudioEvents').DELETE_STREAM,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},replaceStream:function i(j,k){var l={type:c('AudioEvents').REPLACE_STREAM,stream:k,uniqueId:j};c('MusicStoryDispatcher').dispatch(l);},fetchURL:function i(j,k){var l=arguments.length<=2||arguments[2]===undefined?-1:arguments[2],m={type:c('AudioEvents').FETCH_URL,uniqueId:j,subsequentAction:k,value:l};c('MusicStoryDispatcher').dispatch(m);},blockFetches:function i(j){var k={type:c('AudioEvents').BLOCK_FETCH,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);},allowFetches:function i(j){var k={type:c('AudioEvents').ALLOW_FETCH,uniqueId:j};c('MusicStoryDispatcher').dispatch(k);}};f.exports=h;}),null);
__d('AudioMetaData',['immutable'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('immutable').Record({title:'',uri:'',duration:0,copyNumber:-1,dynamicUri:'',playbackPosition:-1,soundcloudBeacons:null}));i=h&&h.prototype;function j(){'use strict';h.apply(this,arguments);}f.exports=j;}),null);
__d('AudioStream',['Audio','AudioEvents','AudioMetaData','Arbiter','immutable','MusicStoryAudioActions','SubscriptionsHandler','curry'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();var j=1000,k={bufferedPosition:0,duration:0,isDynamicUri:false,isFinished:false,isMuted:false,isPlaying:false,isScrubbing:false,playbackPosition:0,audioMetaDataList:c('immutable').List(),activeTrack:0,volume:1,subscriptions:new (c('SubscriptionsHandler'))(),storyIdentifier:null,blockFetches:false},l=[c('AudioEvents').UPDATE_TIME,c('AudioEvents').UPDATE_DURATION,c('AudioEvents').UPDATE_BUFFER,c('AudioEvents').FINISH];h=babelHelpers.inherits(m,c('immutable').Record(k));i=h&&h.prototype;m.createStream=function(n,o,p,q){'use strict';var r=new m(),s=new (c('immutable').List)(),t=void 0,u=p.storyIdentifier,v=p.isPermalink;if(u)r.subscriptions.addSubscriptions(c('Arbiter').subscribe('Story/delete',c('curry')(m.$AudioStream1,o,u)));for(var w=0,x;w<n.length;w++){x=n[w];t=m.createMetaData(x);if(!q)t=m.createAudio(t,o,w,v,q);s=s.push(t);}return r.set('audioMetaDataList',s).set('isDynamicUri',q).set('storyIdentifier',u);};m.createMetaData=function(n){'use strict';return new (c('AudioMetaData'))({title:n.title,uri:n.uri});};m.createAudio=function(n,o,p,q,r){'use strict';var s=n.get(r?'dynamicUri':'uri'),t=c('Audio').addStream(s,{preload:q&&p===0});n=n.set('copyNumber',t);for(var u=l,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var x;if(v){if(w>=u.length)break;x=u[w++];}else{w=u.next();if(w.done)break;x=w.value;}var y=x;c('Audio').addListener(y,m.updatePropertyCallback(o,s,n.get('copyNumber'),y));}if(n.get('playbackPosition')>0)c('Audio').seek(s,t,n.get('playbackPosition'));return n;};m.updatePropertyCallback=function(n,o,p,event){'use strict';var q=void 0;switch(event){case c('AudioEvents').UPDATE_TIME:q=c('MusicStoryAudioActions').updatePlaybackPos;break;case c('AudioEvents').UPDATE_DURATION:q=c('MusicStoryAudioActions').updateDuration;break;case c('AudioEvents').UPDATE_BUFFER:q=c('MusicStoryAudioActions').updateBufferedPos;break;case c('AudioEvents').FINISH:q=c('MusicStoryAudioActions').updateIsFinished;break;}return function(r){if(r.uri===o&&r.index===p)q(n,r.value,r.uri,r.index);};};m.prototype.play=function(){'use strict';var n=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').play(n,this.getActiveCopyNo());};m.prototype.pause=function(){'use strict';var n=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').pause(n,this.getActiveCopyNo());};m.prototype.mute=function(){'use strict';var n=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').mute(n,this.getActiveCopyNo());};m.prototype.unmute=function(){'use strict';var n=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').unmute(n,this.getActiveCopyNo());};m.prototype.seek=function(n){'use strict';var o=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').seek(o,this.getActiveCopyNo(),n);};m.prototype.changeVolume=function(n){'use strict';var o=this.get('isDynamicUri')?this.getActiveDynamicUri():this.getActiveUri();c('Audio').setVolume(o,this.getActiveCopyNo(),n);};m.prototype.getActiveTrackTitle=function(){'use strict';var n=this.get('audioMetaDataList'),o=this.get('activeTrack');return n.get(o).title;};m.prototype.getActiveTrackDurationMs=function(){'use strict';var n=this.get('audioMetaDataList'),o=this.get('activeTrack'),p=n.get(o).duration;return Math.floor(p*j);};m.prototype.getActiveUri=function(){'use strict';var n=this.get('audioMetaDataList').get(this.get('activeTrack'));return n.get('uri');};m.prototype.getActiveDynamicUri=function(){'use strict';var n=this.get('audioMetaDataList').get(this.get('activeTrack'));return n.get('dynamicUri');};m.prototype.getActiveCopyNo=function(){'use strict';var n=this.get('audioMetaDataList').get(this.get('activeTrack'));return n.get('copyNumber');};m.prototype.getBufferedPosition=function(){'use strict';return c('Audio').getBufferedPosition(this.getActiveUri(),this.getActiveCopyNo());};m.prototype.getActiveMetaData=function(){'use strict';return this.get('audioMetaDataList').get(this.get('activeTrack'));};m.$AudioStream1=function(n,o,p,q){'use strict';if(o!==q)return;c('MusicStoryAudioActions').deleteStream(n);};function m(){'use strict';h.apply(this,arguments);}f.exports=m;}),null);
__d("XSoundCloudAudioURLController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/soundcloud\/exchange_url\/",{});}),null);
__d('MusicStoryAudioStore',['AsyncRequest','AudioEvents','AudioStream','FluxReduceStore','immutable','MusicStoryDispatcher','XSoundCloudAudioURLController','MusicStoryAudioActions'],(function a(b,c,d,e,f,g){var h,i,j,k;if(c.__markCompiled)c.__markCompiled();var l={streams:c('immutable').Map()};h=babelHelpers.inherits(m,c('immutable').Record(l));i=h&&h.prototype;m.prototype.getStream=function(o){'use strict';return this.get('streams').get(o);};m.prototype.setStream=function(o,p){'use strict';return this.get('streams').set(o,p);};function m(){'use strict';h.apply(this,arguments);}j=babelHelpers.inherits(n,c('FluxReduceStore'));k=j&&j.prototype;n.prototype.getInitialState=function(){'use strict';return new m();};n.prototype.getStream=function(o){'use strict';return this.getState().getStream(o);};n.prototype.getBeacons=function(o){'use strict';return this.getStream(o).getActiveMetaData().get('soundcloudBeacons');};n.prototype.getActiveTrackTitle=function(o){'use strict';var p=this.getState().getStream(o);return p.getActiveTrackTitle();};n.prototype.getActiveTrackDurationMs=function(o){'use strict';var p=this.getState().getStream(o);return p.getActiveTrackDurationMs();};n.prototype.getIsPlaying=function(o){'use strict';return this.getState().getStream(o).get('isPlaying');};n.prototype.getIsDynamicURL=function(o){'use strict';return this.getState().getStream(o).get('isDynamicUri');};n.prototype.reduce=function(o,p){'use strict';var q=void 0,r=p.uniqueId;switch(p.type){case c('AudioEvents').CREATE_STREAM:q=c('AudioStream').createStream(p.titleUriList,r,p.extraData,p.isDynamicUri);o=o.set('streams',o.setStream(r,q));return o;case c('AudioEvents').REPLACE_STREAM:o=o.set('streams',o.setStream(r,p.stream));return o;case c('AudioEvents').BLOCK_FETCH:q=o.getStream(r);q=q.set('blockFetches',true);o=this.doBooleanAction(o,r,c('AudioEvents').PAUSE);o=o.set('streams',o.setStream(r,q));return o;case c('AudioEvents').ALLOW_FETCH:q=o.getStream(r);q=q.set('blockFetches',false);o=o.set('streams',o.setStream(r,q));return o;case c('AudioEvents').FETCH_URL:this.fetchDynamicUri(o.getStream(r),r,p.subsequentAction,p.value);return o;case c('AudioEvents').PLAY:case c('AudioEvents').PAUSE:case c('AudioEvents').MUTE:case c('AudioEvents').UNMUTE:return this.doBooleanAction(o,r,p.type);case c('AudioEvents').VOLUME_CHANGE:return this.doNumericAction(o,r,p.type,p.value);case c('AudioEvents').SCRUB_BEGIN:if(o.getStream(r).get('isPlaying'))o=this.doBooleanAction(o,r,p.type);o=this.setProperty(o,r,'isScrubbing',true);return o;case c('AudioEvents').SCRUB_END:if(o.getStream(r).get('isPlaying'))o=this.doBooleanAction(o,r,p.type);if(o.getStream(r).get('isFinished'))o=this.doBooleanAction(o,r,c('AudioEvents').PLAY);o=this.doNumericAction(o,r,p.type,p.value);o=this.setProperty(o,r,'isScrubbing',false);return o;case c('AudioEvents').UPDATE_TIME:o=this.setProperty(o,r,'playbackPosition',p.value);return this.setMetaDataProperty(o,r,'playbackPosition',p.value);case c('AudioEvents').UPDATE_DURATION:return this.setDuration(o,r,p.uri,p.copyNumber,p.value);case c('AudioEvents').UPDATE_BUFFER:return this.setProperty(o,r,'bufferedPosition',p.value);case c('AudioEvents').FINISH:return this.setIsFinished(o,r,true);case c('AudioEvents').STREAM_CHANGE:return this.changeActiveStream(o,r,p.value);default:return o;}};n.prototype.deleteStream=function(o,p){'use strict';return this.doBooleanAction(o,p,c('AudioEvents').PAUSE);};n.prototype.changeActiveStream=function(o,p,q){'use strict';var r=o.getStream(p),s=r.get('isMuted'),t=r.get('volume');o=this.doBooleanAction(o,p,c('AudioEvents').PAUSE);o=this.doNumericAction(o,p,c('AudioEvents').SCRUB_END,0);o=this.setProperty(o,p,'activeTrack',q);var u=this.getBufferedPosition(o,p);o=this.setProperty(o,p,'bufferedPosition',u);o=this.setProperty(o,p,'duration',this.getTrackDuration(o,p,q));o=s?this.doBooleanAction(o,p,c('AudioEvents').MUTE):this.doBooleanAction(o,p,c('AudioEvents').UNMUTE);o=this.doNumericAction(o,p,c('AudioEvents').VOLUME_CHANGE,t);o=this.doBooleanAction(o,p,c('AudioEvents').PLAY);return o;};n.prototype.getBufferedPosition=function(o,p){'use strict';var q=o.getStream(p);return q.getBufferedPosition();};n.prototype.getTrackDuration=function(o,p,q){'use strict';var r=o.getStream(p),s=r.get('audioMetaDataList');return s.get(q).duration;};n.prototype.setDuration=function(o,p,q,r,s){'use strict';var t=0,u=false,v=o.getStream(p),w=v.get('audioMetaDataList');w=w.map(function(x){var y=v.get('isDynamicUri')?x.get('dynamicUri'):x.get('uri');if(y===q&&x.copyNumber===r){x=x.set('duration',s);if(t===v.get('activeTrack'))u=true;}t++;return x;});v=v.set('audioMetaDataList',w);o=o.set('streams',o.setStream(p,v));if(u)o=this.setProperty(o,p,'duration',s);return o;};n.prototype.setIsFinished=function(o,p,q){'use strict';o=this.doBooleanAction(o,p,c('AudioEvents').PAUSE);o=this.setMetaDataProperty(o,p,'playbackPosition',-1);return this.setProperty(o,p,'isFinished',q);};n.prototype.doBooleanAction=function(o,p,q){'use strict';var r=[],s=[],t=o.getStream(p);s.push(q===c('AudioEvents').PLAY||q===c('AudioEvents').MUTE||q===c('AudioEvents').SCRUB_BEGIN);if(q===c('AudioEvents').PLAY||q===c('AudioEvents').PAUSE){r.push('isPlaying');var u=o.getStream(p).get('isFinished');if(q===c('AudioEvents').PLAY&&u){r.push('isFinished');s.push(false);}}else if(q===c('AudioEvents').MUTE||q===c('AudioEvents').UNMUTE)r.push('isMuted');switch(q){case c('AudioEvents').PLAY:case c('AudioEvents').SCRUB_END:t.play();break;case c('AudioEvents').PAUSE:case c('AudioEvents').SCRUB_BEGIN:t.pause();break;case c('AudioEvents').MUTE:t.mute();break;case c('AudioEvents').UNMUTE:t.unmute();break;default:throw new Error('Unsupported boolean action: '+q);}for(var v=0;v<r.length;v++)o=this.setProperty(o,p,r[v],s[v]);return o;};n.prototype.fetchDynamicUri=function(o,p,q,r){'use strict';new (c('AsyncRequest'))().setURI(c('XSoundCloudAudioURLController').getURIBuilder().getURI()).setMethod('POST').setData({endpoint_url:o.getActiveUri()}).setHandler(function(s){var t=s.payload.media,u=s.payload.beacons,v=o.getActiveMetaData(),w=document.createElement('audio'),x=w.canPlayType('application/vnd.apple.mpegURL')!=='',y=x?t.hls:t.http;v=v.set('dynamicUri',y);v=v.set('soundcloudBeacons',u);v=c('AudioStream').createAudio(v,p,-1,false,true);var z=o.get('audioMetaDataList').set(o.get('activeTrack'),v);o=o.set('audioMetaDataList',z);c('MusicStoryAudioActions').replaceStream(p,o);switch(q){case c('AudioEvents').PLAY:c('MusicStoryAudioActions').play(p,u.play);break;case c('AudioEvents').SCRUB_END:c('MusicStoryAudioActions').scrubEnd(p,r);break;default:break;}c('MusicStoryAudioActions').allowFetches(p);}).setErrorHandler(function(s){}).send();};n.prototype.doNumericAction=function(o,p,q,r){'use strict';var s=void 0,t=o.getStream(p);if(q===c('AudioEvents').SCRUB_END){t.seek(r);s='playbackPosition';}else if(q===c('AudioEvents').VOLUME_CHANGE){t.changeVolume(r);s='volume';}else throw new Error('Unsupported integer action: '+q);return this.setProperty(o,p,s,r);};n.prototype.setProperty=function(o,p,q,r){'use strict';var s=o.getStream(p);s=s.set(q,r);return o.set('streams',o.setStream(p,s));};n.prototype.setMetaDataProperty=function(o,p,q,r){'use strict';var s=o.getStream(p),t=s.get('activeTrack'),u=s.get('audioMetaDataList'),v=u.get(t);v=v.set(q,r);u=u.set(t,v);s=s.set('audioMetaDataList',u);return o.set('streams',o.setStream(p,s));};function n(){'use strict';j.apply(this,arguments);}f.exports=new n(c('MusicStoryDispatcher'));}),null);
__d('MusicStoryBanzaiFeedLogger',['Banzai'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={logOutboundClick:function i(j){if(j)c('Banzai').post('music_story_outbound_click',j);}};f.exports=h;}),null);
__d('MusicStoryEventLogger',['MusicStoryLoggerEvents','MusicStoryTypedLogger'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MusicStoryTypedLogger'));i=h&&h.prototype;j.isValidRequiredData=function(k){'use strict';return k.hasOwnProperty('artist_name')&&k.hasOwnProperty('content_id')&&k.hasOwnProperty('has_minutiae')&&k.hasOwnProperty('minutiae_id')&&k.hasOwnProperty('music_id')&&k.hasOwnProperty('platform_name')&&k.hasOwnProperty('story_type');};function j(k){'use strict';if(!j.isValidRequiredData(k))throw new Error('Cannot create MusicStoryEventLogger, '+'RequiredData: '+JSON.stringify(k)+' is missing required fields ');i.constructor.call(this);this.$MusicStoryEventLogger1=k;this.$MusicStoryEventLogger2=-1;}j.prototype.logRequiredData=function(){'use strict';this.updateData(this.$MusicStoryEventLogger1);return this;};j.prototype.logAdditionalData=function(k){'use strict';this.updateData(k);return this;};j.prototype.logEvent=function(event){var k=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];'use strict';var l=[];switch(event){case c('MusicStoryLoggerEvents').CTA_CLICK:l.push('cta_action');break;case c('MusicStoryLoggerEvents').ERROR:l.push('error');break;case c('MusicStoryLoggerEvents').PLAY:l.push('audio_duration_ms');this.startPlaytimeTracker();break;case c('MusicStoryLoggerEvents').PAUSE:case c('MusicStoryLoggerEvents').REACHED_END:l.push('play_duration_ms');if(this.$MusicStoryEventLogger2<0)return;k.play_duration_ms=this.stopPlaytimeTracker();break;case c('MusicStoryLoggerEvents').STALL:break;default:break;}for(var m=l,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;if(!k.hasOwnProperty(q))throw new Error('The field: '+q+' must be logged with '+event);}this.logRequiredData().logAdditionalData(k).setEvent(event).log();this.clear();};j.prototype.startPlaytimeTracker=function(){'use strict';this.$MusicStoryEventLogger2=Date.now();};j.prototype.stopPlaytimeTracker=function(){'use strict';if(this.$MusicStoryEventLogger2<0)throw new Error('Cannot log event without a play event logged first');var k=Date.now()-this.$MusicStoryEventLogger2;this.$MusicStoryEventLogger2=-1;return k;};f.exports=j;}),null);
__d('MusicStoryLoggingStore',['AudioEvents','FluxReduceStore','immutable','MusicStoryAudioStore','MusicStoryDispatcher','MusicStoryEventLogger','MusicStoryLoggerEvents'],(function a(b,c,d,e,f,g){var h,i,j,k,l,m;if(c.__markCompiled)c.__markCompiled();var n=1000,o={loggerIndex:c('immutable').Map(),soundcloudCheckpointIndex:c('immutable').Map()};h=babelHelpers.inherits(p,c('immutable').Record(o));i=h&&h.prototype;p.prototype.getLogger=function(s){'use strict';return this.get('loggerIndex').get(s);};p.prototype.getCheckpointTracker=function(s){'use strict';return this.get('soundcloudCheckpointIndex').get(s);};function p(){'use strict';h.apply(this,arguments);}j=babelHelpers.inherits(q,c('immutable').Record({lastUpdateTimeStamp:-1,timePlayedSinceLastCheckpoint:0}));k=j&&j.prototype;function q(){'use strict';j.apply(this,arguments);}l=babelHelpers.inherits(r,c('FluxReduceStore'));m=l&&l.prototype;r.prototype.getInitialState=function(){'use strict';return new p();};r.prototype.reduce=function(s,t){'use strict';var u=t.uniqueId,v=s.getLogger(u);if(v===null)return s;var w=c('MusicStoryAudioStore').getActiveTrackDurationMs(u),x=c('MusicStoryAudioStore').getActiveTrackTitle(u),y=c('MusicStoryAudioStore').getIsPlaying(u),z=c('MusicStoryAudioStore').getBeacons(u),aa=c('MusicStoryAudioStore').getIsDynamicURL(u);switch(t.type){case c('AudioEvents').CREATE_STREAM:var ba=t.loggingData;if(ba!=null){s=this.addLogger(s,u,ba);}else s=this.addNullLogger(s,u);s=this.addCheckpointTracker(s,u);break;case c('AudioEvents').PAUSE:if(aa){v.logEvent(c('MusicStoryLoggerEvents').PAUSE,{audio_duration_ms:w,audio_title:x,beacon_url:z.pause,clienttime:Date.now()});s=this.pauseCheckpointTracker(s,u);}v.logEvent(c('MusicStoryLoggerEvents').PAUSE,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').PLAY:if(aa){v.logEvent(c('MusicStoryLoggerEvents').PLAY,{audio_duration_ms:w,audio_title:x,beacon_url:z.play,clienttime:Date.now()});s=this.startCheckpointTracker(s,u);}else v.logEvent(c('MusicStoryLoggerEvents').PLAY,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').SCRUB_BEGIN:if(y)v.logEvent(c('MusicStoryLoggerEvents').PAUSE,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').SCRUB_END:if(y)v.logEvent(c('MusicStoryLoggerEvents').PLAY,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').FINISH:if(aa){s=this.pauseCheckpointTracker(s,u);v.logEvent(c('MusicStoryLoggerEvents').PAUSE,{audio_duration_ms:w,audio_title:x,beacon_url:z.stop,clienttime:Date.now()});}v.logEvent(c('MusicStoryLoggerEvents').REACHED_END,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').STREAM_CHANGE:if(y)v.logEvent(c('MusicStoryLoggerEvents').PAUSE,{audio_duration_ms:w,audio_title:t.previousTitle});v.logEvent(c('MusicStoryLoggerEvents').PLAY,{audio_duration_ms:w,audio_title:x});break;case c('AudioEvents').UPDATE_TIME:if(aa){var ca=Date.now(),da=s.getCheckpointTracker(u),ea=da,fa=ea.lastUpdateTimeStamp,ga=ea.timePlayedSinceLastCheckpoint;if(fa>0){ga+=ca-fa;if(ga>29.5*n){var ha=z.checkpoint;v.logEvent('music_soundcloud_checkpoint',{beacon_url:ha,clienttime:Date.now()});ga=0;}fa=ca;da=da.set('lastUpdateTimeStamp',fa);da=da.set('timePlayedSinceLastCheckpoint',ga);var ia=s.get('soundcloudCheckpointIndex');ia=ia.set(u,da);s=s.set('soundcloudCheckpointIndex',ia);}}break;case c('AudioEvents').MUTE:case c('AudioEvents').UNMUTE:case c('AudioEvents').VOLUME_CHANGE:case c('AudioEvents').UPDATE_DURATION:case c('AudioEvents').UPDATE_BUFFER:break;}return s;};r.prototype.addLogger=function(s,t,u){'use strict';var v=s.get('loggerIndex');v=v.set(t,new (c('MusicStoryEventLogger'))(u));return s.set('loggerIndex',v);};r.prototype.addCheckpointTracker=function(s,t){'use strict';var u=s.get('soundcloudCheckpointIndex');u=u.set(t,new q());return s.set('soundcloudCheckpointIndex',u);};r.prototype.addNullLogger=function(s,t){'use strict';var u=s.get('loggerIndex');u=u.set(t,null);return s.set('loggerIndex',u);};r.prototype.pauseCheckpointTracker=function(s,t){'use strict';var u=s.getCheckpointTracker(t);u=u.set('lastUpdateTimeStamp',-1);var v=s.get('soundcloudCheckpointIndex');v=v.set(t,u);return s.set('soundcloudCheckpointIndex',v);};r.prototype.startCheckpointTracker=function(s,t){'use strict';var u=s.getCheckpointTracker(t);u=u.set('lastUpdateTimeStamp',Date.now());var v=s.get('soundcloudCheckpointIndex');v=v.set(t,u);return s.set('soundcloudCheckpointIndex',v);};function r(){'use strict';l.apply(this,arguments);}f.exports=new r(c('MusicStoryDispatcher'));}),null);
__d('MusicStoryBaseContainer.react',['AudioEvents','MusicStoryBanzaiFeedLogger','React','ReactComponentWithPureRenderMixin','MusicStoryAudioActions','MusicStoryAudioStore','MusicStoryLoggingStore','MusicStoryDispatcher'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;j.getStores=function(){'use strict';return [c('MusicStoryAudioStore'),c('MusicStoryLoggingStore')];};function j(k){'use strict';i.constructor.call(this,k);c('MusicStoryDispatcher').explicitlyRegisterStores([c('MusicStoryAudioStore'),c('MusicStoryLoggingStore')]);var l=k.loggingData,m=k.uniqueId,n=k.titleUriList,o=k.extraData,p=o.isDynamicUri;c('MusicStoryAudioActions').createStream(n,l,m,o,p);if(p){c('MusicStoryAudioActions').blockFetches(this.props.uniqueId);c('MusicStoryAudioActions').fetchURL(this.props.uniqueId,c('AudioEvents').CREATE_STREAM);}}j.prototype.play=function(){'use strict';c('MusicStoryBanzaiFeedLogger').logOutboundClick(this.props.ftKey);if(this.state.isDynamicUri){if(!this.state.blockFetches){c('MusicStoryAudioActions').blockFetches(this.props.uniqueId);c('MusicStoryAudioActions').fetchURL(this.props.uniqueId,c('AudioEvents').PLAY);}}else c('MusicStoryAudioActions').play(this.props.uniqueId);};j.prototype.pause=function(){'use strict';if(this.state.isDynamicUri){var k=c('MusicStoryAudioStore').getBeacons(this.props.uniqueId);c('MusicStoryAudioActions').pause(this.props.uniqueId,k.pause);}else c('MusicStoryAudioActions').pause(this.props.uniqueId);};j.prototype.scrubBegin=function(){'use strict';c('MusicStoryAudioActions').scrubBegin(this.props.uniqueId);};j.prototype.scrubEnd=function(k){'use strict';if(this.state.isDynamicUri){if(!this.state.blockFetches){c('MusicStoryAudioActions').blockFetches(this.props.uniqueId);c('MusicStoryAudioActions').fetchURL(this.props.uniqueId,c('AudioEvents').SCRUB_END,k);}}else c('MusicStoryAudioActions').scrubEnd(this.props.uniqueId,k);};j.prototype.mute=function(){'use strict';c('MusicStoryAudioActions').mute(this.props.uniqueId);};j.prototype.unmute=function(){'use strict';c('MusicStoryAudioActions').unmute(this.props.uniqueId);};j.prototype.toggleMuted=function(){'use strict';this.state.isMuted?this.unmute():this.mute();};j.prototype.changeVolume=function(k){'use strict';c('MusicStoryAudioActions').setVolume(this.props.uniqueId,k);};f.exports=j;}),null);
__d('MusicStoryCollectionListItem.react',['ix','cx','Image.react','React','XUIText.react','fbglyph'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=function k(l){var m=l.isPlaying,n=l.isActive,o=l.index,p=l.title,q=l.onTrackClick,r=void 0;if(m){r=c('React').createElement(c('Image.react'),{className:"_3-_y _3-4s",src:h("\/images\/assets_DO_NOT_HARDCODE\/fb_glyphs\/volume_16_white.png")});}else r=c('React').createElement(c('XUIText.react'),{className:"_3-4s",size:'small',weight:'normal'},o+1+'.');return (c('React').createElement('div',{className:"_3-4r"+(n?' '+"_59j3":''),onClick:function s(){return q(l.index);}},r,c('React').createElement(c('XUIText.react'),{className:"_3-4p",size:'small',weight:'normal'},p)));};f.exports=j;}),null);
__d('MusicStoryCollectionTrackList.react',['cx','MusicStoryCollectionListItem.react','React','ScrollableArea.react'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function j(k){var l=k.titleUriList.map(function(m,n){return (c('React').createElement(c('MusicStoryCollectionListItem.react'),{key:n,index:n,title:m.title,uri:m.uri,isPlaying:k.isPlaying&&n===k.activeTrack,isActive:n===k.activeTrack,onTrackClick:k.onTrackClick}));});return (c('React').createElement(c('ScrollableArea.react'),{className:"_3cf2"},l));};f.exports=i;}),null);
__d('MusicStoryTrackListContainer.react',['MusicStoryBanzaiFeedLogger','FluxContainer','React','MusicStoryAudioActions','MusicStoryAudioStore','MusicStoryCollectionTrackList.react','MusicStoryBaseContainer.react'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MusicStoryBaseContainer.react'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.$MusicStoryTrackListContainer1=this.onTrackClick.bind(this);}j.prototype.onTrackClick=function(k){'use strict';if(this.state.activeTrack===k){this.state.isPlaying?this.pause():this.play();}else{var l=this.props.uniqueId,m=c('MusicStoryAudioStore').getActiveTrackTitle(l);c('MusicStoryBanzaiFeedLogger').logOutboundClick(this.props.ftKey);c('MusicStoryAudioActions').changeStream(l,k,m);}};j.calculateState=function(k,l){'use strict';var m=l.uniqueId,n=c('MusicStoryAudioStore').getStream(m),o=n.activeTrack,p=n.bufferedPosition,q=n.isMuted,r=n.isPlaying,s=n.playbackPosition,t=n.volume,u=n.isFinished,v=n.duration,w={activeTrack:o,bufferedPosition:p,finishedPlaying:u,isMuted:q,isPlaying:r,playbackDuration:v,playbackPosition:s,volume:t,blockFetches:false,isDynamicUri:false};return w;};j.prototype.componentDidUpdate=function(k,l){var m,n=this;'use strict';if(!l.finishedPlaying&&this.state.finishedPlaying){var m=function(){var o=n.state.activeTrack+1;if(o>=n.props.titleUriList.length)return {v:void 0};setTimeout(function(){if(this.state.activeTrack!==o-1)return;c('MusicStoryAudioActions').changeStream(this.props.uniqueId,o,c('MusicStoryAudioStore').getActiveTrackTitle(this.props.uniqueId));}.bind(n),1500);}();if(typeof m==="object")return m.v;}};j.prototype.render=function(){'use strict';return (c('React').createElement(c('MusicStoryCollectionTrackList.react'),{activeTrack:this.state.activeTrack,isPlaying:this.state.isPlaying,onTrackClick:this.$MusicStoryTrackListContainer1,uniqueId:this.props.uniqueId,titleUriList:this.props.titleUriList}));};f.exports=c('FluxContainer').create(j,{withProps:true});}),null);
__d("XSpotifyWebAPIAuthDialogController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/auth\/",{__asyncDialog:{type:"Int"}});}),null);
__d("XSpotifyWebAPIIsAlbumSavedController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/is_album_saved\/",{});}),null);
__d("XSpotifyWebAPIIsSongSavedController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/is_song_saved\/",{});}),null);
__d("XSpotifyWebAPISaveAlbumController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/save_album\/",{});}),null);
__d("XSpotifyWebAPISaveSongController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/save_song\/",{});}),null);
__d("XSpotifyWebAPIUnsaveAlbumController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/unsave_album\/",{});}),null);
__d("XSpotifyWebAPIUnsaveSongController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/music\/spotify\/unsave_song\/",{});}),null);
__d('SimpleMusicStoryCTA',['cx','fbt','AsyncRequest','CSS','DOM','MusicStoryAudioStore','MusicStoryLoggerEvents','MusicStoryEventLogger','MusicStoryBanzaiFeedLogger','RTISubscriptionManager','Run','XSpotifyWebAPIAuthDialogController','XSpotifyWebAPIIsAlbumSavedController','XSpotifyWebAPIIsSongSavedController','XSpotifyWebAPISaveAlbumController','XSpotifyWebAPISaveSongController','XSpotifyWebAPIUnsaveAlbumController','XSpotifyWebAPIUnsaveSongController','XSpotifyWebAPIControllerConstants','ChannelManager'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();c('ChannelManager');j.authorize=function(k,l){'use strict';k.addEventListener('click',function(m){window.open(l);});};j.closeWindow=function(){'use strict';window.close();};function j(k,l,m){'use strict';this.$SimpleMusicStoryCTA1=m.album;this.$SimpleMusicStoryCTA3=k;this.$SimpleMusicStoryCTA9=l;this.$SimpleMusicStoryCTA16=m.uri;this.$SimpleMusicStoryCTA6=m.saved;this.$SimpleMusicStoryCTA7=false;this.$SimpleMusicStoryCTA8=m.loggedIn;this.$SimpleMusicStoryCTA2=m.appName;this.$SimpleMusicStoryCTA11=false;this.$SimpleMusicStoryCTA15=m.ftkey;this.$SimpleMusicStoryCTA19=m.uniqueId;this.$SimpleMusicStoryCTA20=m.isDynamicUri;var n=m.loggingData;if(n!==null){this.$SimpleMusicStoryCTA4=new (c('MusicStoryEventLogger'))(n);this.$SimpleMusicStoryCTA7=true;}switch(this.$SimpleMusicStoryCTA2){case 'Spotify':this.$SimpleMusicStoryCTA13=i._("Add to Spotify");this.$SimpleMusicStoryCTA17=i._("Added to Spotify");this.$SimpleMusicStoryCTA10=this.onSpotifyClick;break;case 'iTunes':this.$SimpleMusicStoryCTA13=i._("Get it on iTunes");this.$SimpleMusicStoryCTA17='';this.$SimpleMusicStoryCTA10=this.onDefaultClick;break;default:var o=this.$SimpleMusicStoryCTA2;this.$SimpleMusicStoryCTA13=i._("Listen on {partnerName}",[i.param('partnerName',o)]);this.$SimpleMusicStoryCTA17='';this.$SimpleMusicStoryCTA10=this.onDefaultClick;}if(this.$SimpleMusicStoryCTA6){c('DOM').setContent(this.$SimpleMusicStoryCTA9,this.$SimpleMusicStoryCTA17);this.setUnsaveWidth();}else{c('DOM').setContent(this.$SimpleMusicStoryCTA9,this.$SimpleMusicStoryCTA13);this.setSaveWidth();}k.addEventListener('click',function(p){if(!this.$SimpleMusicStoryCTA11){this.$SimpleMusicStoryCTA11=true;this.$SimpleMusicStoryCTA10.bind(this)();setTimeout(function(){this.$SimpleMusicStoryCTA11=false;}.bind(this),500);}}.bind(this));if(this.$SimpleMusicStoryCTA8)c('Run').onAfterLoad(this.checkIsSaved.bind(this));}j.prototype.checkIsSaved=function(){'use strict';var k=void 0,l=void 0;if(this.$SimpleMusicStoryCTA1){k=c('XSpotifyWebAPIIsAlbumSavedController').getURIBuilder().getURI();l={album_url:this.$SimpleMusicStoryCTA16};}else{k=c('XSpotifyWebAPIIsSongSavedController').getURIBuilder().getURI();l={song_url:this.$SimpleMusicStoryCTA16};}new (c('AsyncRequest'))().setURI(k).setMethod('POST').setData(l).setHandler(function(m){this.onSavedResponse(m);}.bind(this)).send();};j.prototype.onSavedResponse=function(k){'use strict';var l=k.payload;if(l)this.showAsSaved();};j.prototype.onSpotifyClick=function(){'use strict';c('MusicStoryBanzaiFeedLogger').logOutboundClick(this.$SimpleMusicStoryCTA15);if(!this.$SimpleMusicStoryCTA6){this.save();}else this.unsave();};j.prototype.onDefaultClick=function(){'use strict';c('MusicStoryBanzaiFeedLogger').logOutboundClick(this.$SimpleMusicStoryCTA15);var k=this.$SimpleMusicStoryCTA20?{cta_action:'webview',beacon_url:c('MusicStoryAudioStore').getBeacons(this.$SimpleMusicStoryCTA19).ctaClickOpen,clienttime:Date.now()}:{cta_action:'webview'};this.logEvent(c('MusicStoryLoggerEvents').CTA_CLICK,k);window.open(this.$SimpleMusicStoryCTA16);};j.prototype.authorize=function(){'use strict';var k=c('XSpotifyWebAPIAuthDialogController').getURIBuilder().getURI();this.subscribeToSpotifyLogin(this.onSpotifyClick.bind(this));new (c('AsyncRequest'))().setURI(k).setMethod('POST').send();};j.prototype.save=function(){var k=arguments.length<=0||arguments[0]===undefined?true:arguments[0];'use strict';var l=void 0,m=void 0;if(this.$SimpleMusicStoryCTA1){l=c('XSpotifyWebAPISaveAlbumController').getURIBuilder().getURI();m={album_url:this.$SimpleMusicStoryCTA16};}else{l=c('XSpotifyWebAPISaveSongController').getURIBuilder().getURI();m={song_url:this.$SimpleMusicStoryCTA16};}new (c('AsyncRequest'))().setURI(l).setMethod('POST').setData(m).setHandler(function(n){this.onServerResponse(n,k);}.bind(this)).send();};j.prototype.onSaveSuccess=function(){'use strict';this.logEvent(c('MusicStoryLoggerEvents').CTA_CLICK,{cta_action:'spotify_save'});this.showAsSaved();};j.prototype.unsave=function(){var k=arguments.length<=0||arguments[0]===undefined?true:arguments[0];'use strict';var l=void 0,m=void 0;if(this.$SimpleMusicStoryCTA1){l=c('XSpotifyWebAPIUnsaveAlbumController').getURIBuilder().getURI();m={album_url:this.$SimpleMusicStoryCTA16};}else{l=c('XSpotifyWebAPIUnsaveSongController').getURIBuilder().getURI();m={song_url:this.$SimpleMusicStoryCTA16};}new (c('AsyncRequest'))().setURI(l).setMethod('POST').setData(m).setHandler(function(n){this.onServerResponse(n,k);}.bind(this)).send();};j.prototype.onUnsaveSuccess=function(){'use strict';this.logEvent(c('MusicStoryLoggerEvents').CTA_CLICK,{cta_action:'spotify_unsave'});this.showAsUnsaved();};j.prototype.showAsSaved=function(){'use strict';this.doSaveAnimation();this.$SimpleMusicStoryCTA6=true;};j.prototype.showAsUnsaved=function(){'use strict';this.doUnsaveAnimation();this.$SimpleMusicStoryCTA6=false;};j.prototype.onServerResponse=function(k,l){'use strict';k=k.payload;if(k===c('XSpotifyWebAPIControllerConstants').SAVE_SUCCESS){this.onSaveSuccess();}else if(k===c('XSpotifyWebAPIControllerConstants').UNSAVE_SUCCESS){this.onUnsaveSuccess();}else if(k===c('XSpotifyWebAPIControllerConstants').LOGIN_REQUIRED&&l){this.authorize();}else this.logEvent(c('MusicStoryLoggerEvents').CTA_CLICK,{cta_action:'spotify_login_fail'});};j.prototype.doSaveAnimation=function(){'use strict';this.$SimpleMusicStoryCTA3.offsetWidth;c('CSS').addClass(this.$SimpleMusicStoryCTA3,"_1t00");setTimeout(function(){c('DOM').setContent(this.$SimpleMusicStoryCTA9,this.$SimpleMusicStoryCTA17);}.bind(this),120);this.setUnsaveWidth();};j.prototype.doUnsaveAnimation=function(){'use strict';c('CSS').removeClass(this.$SimpleMusicStoryCTA3,"_1t00");setTimeout(function(){c('DOM').setContent(this.$SimpleMusicStoryCTA9,this.$SimpleMusicStoryCTA13);}.bind(this),120);this.setSaveWidth();};j.prototype.setSaveWidth=function(){'use strict';this.$SimpleMusicStoryCTA3.style.width=this.getWidthOfText(this.$SimpleMusicStoryCTA13,'14')+20+46+'px';};j.prototype.setUnsaveWidth=function(){'use strict';this.$SimpleMusicStoryCTA3.style.width=this.getWidthOfText(this.$SimpleMusicStoryCTA17,'14')+20+56+'px';};j.prototype.getWidthOfText=function(k,l){'use strict';var m=document.createElement('canvas'),n=m.getContext('2d');n.font=l+'px';var o=n.measureText(k).width;return o;};j.prototype.subscribeToSpotifyLogin=function(){'use strict';c('RTISubscriptionManager').subscribe('music/auth_code_received/success',function(k){this.save(false);c('RTISubscriptionManager').unsubscribe('music/auth_code_received/success');}.bind(this));};j.prototype.logEvent=function(event,k){'use strict';if(this.$SimpleMusicStoryCTA7)this.$SimpleMusicStoryCTA4.logEvent(event,k);};f.exports=j;}),null);
__d('SimpleMusicAudioControls.react',['cx','EmbeddedVideoPlaybackControl.react','EmbeddedVideoPlaybackTimer.react','React','EmbeddedVideoScrubber.react','EmbeddedVideoVolumeControl.react'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function j(k){var l="_2mbj _2mbk",m="_2mbj _yaw",n="_2mbj _409j",o="_i5q",p=k.playbackPosition-k.playbackDuration,q=c('React').createElement(c('EmbeddedVideoPlaybackTimer.react'),{className:"_25e2",remainingTimestamp:Math.round(p),playbackPosTimestamp:k.playbackPosition}),r=c('React').createElement(c('EmbeddedVideoPlaybackControl.react'),{finishedPlaying:k.finishedPlaying,isPlaying:k.isPlaying,onPause:k.onPause,onPlay:k.onPlay,tabIndex:'0'}),s=c('React').createElement(c('EmbeddedVideoScrubber.react'),{bufferedPosition:k.bufferedPosition,onScrubBegin:k.onScrubBegin,onScrubEnd:k.onScrubEnd,playbackDuration:k.playbackDuration,playbackPosition:k.playbackPosition,tabIndex:'0'}),t=c('React').createElement(c('EmbeddedVideoVolumeControl.react'),{isMuted:k.isMuted,onToggleMuted:k.onToggleMuted,onVolumeChange:k.onVolumeChange,volume:k.volume,tabIndex:'0'});return (c('React').createElement('div',{className:o},c('React').createElement('div',{className:"_4lqt"},c('React').createElement('div',{className:"_5rbl"},c('React').createElement('div',{className:"_2mbh"},c('React').createElement('div',{className:l},r),c('React').createElement('div',{className:m},s),c('React').createElement('div',{className:n},q,t))))));};f.exports=i;}),null);
__d('MusicStoryAudioControlsContainer.react',['SimpleMusicAudioControls.react','FluxContainer','React','MusicStoryAudioStore','MusicStoryBaseContainer.react'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('MusicStoryBaseContainer.react'));i=h&&h.prototype;j.calculateState=function(k,l){'use strict';var m=l.uniqueId,n=c('MusicStoryAudioStore').getStream(m),o=n.bufferedPosition,p=n.isMuted,q=n.isPlaying,r=n.playbackPosition,s=n.volume,t=n.isFinished,u=n.duration,v=n.isDynamicUri,w=n.blockFetches,x={bufferedPosition:o,finishedPlaying:t,isMuted:p,isPlaying:q,playbackDuration:u,playbackPosition:r,volume:s,isDynamicUri:v,blockFetches:w};return x;};j.prototype.render=function(){'use strict';return (c('React').createElement(c('SimpleMusicAudioControls.react'),babelHelpers['extends']({onPlay:this.play.bind(this),onPause:this.pause.bind(this),onScrubBegin:this.scrubBegin.bind(this),onScrubEnd:this.scrubEnd.bind(this),onToggleMuted:this.toggleMuted.bind(this),onVolumeChange:this.changeVolume.bind(this)},this.state)));};function j(){'use strict';h.apply(this,arguments);}f.exports=c('FluxContainer').create(j,{withProps:true});}),null);